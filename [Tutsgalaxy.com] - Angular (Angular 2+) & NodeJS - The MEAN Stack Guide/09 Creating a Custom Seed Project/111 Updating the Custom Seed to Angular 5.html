<html>
                        <head>
                        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
                        <title>111 Updating the Custom Seed to Angular 5</title>
                        </head>
                        <body>
                        <div class="container">
                        <div class="row">
                        <div class="col-md-10 col-md-offset-1">
                            <p class="lead"><div class="asset-container">
    <div class="asset-container__padding article-view">
        <div class="w3c-default">
            <p>In this module, we re-built the seed-project provided in this course. But we did this with Angular 2. Maybe that's all you need but if you want to update it to the latest version, here are the required adjustments to make it work.</p>

<p>Since Angular 5 doesn't break Angular 2 code, we only need to change our build process and the respective config files. You don't need to change any of your Angular 2 application code.</p>























































































<p>1)<strong>Let's start by updating the <code>package.json</code>:</strong></p>























































































<p>First of all, we need to install Angular 4 and you can do this by running:</p>























































































<p><code>npm install --save @angular/core @angular/common @angular/animations @angular/platform-browser @angular/platform-browser-dynamic @angular/forms @angular/http @angular/router @angular/compiler @angular/compiler-cli</code></p>

















































































<p>and possibly (but not required) also</p>























































































<p><code>npm install --save @angular/platform-server @angular/upgrade</code></p>

















































































<p>Of course we should also update the polyfills and dependencies of Angular:</p>

















































































<p><code>npm install --save core-js zone.js rxjs</code></p>















































































<p>After running all these commands, your package.json file should hold the following <code>dependencies</code> (version numbers may vary):</p>















































































<pre class="prettyprint linenums">"dependencies": {
  "@angular/animations": "^4.0.0",
  "@angular/common": "^4.0.0",
  "@angular/compiler": "^4.0.0",
  "@angular/compiler-cli": "^4.0.0",
  "@angular/core": "^4.0.0",
  "@angular/forms": "^4.0.0",
  "@angular/http": "^4.0.0",
  "@angular/platform-browser": "^4.0.0",
  "@angular/platform-browser-dynamic": "^4.0.0",
  "@angular/platform-server": "^4.0.0",
  "@angular/router": "^4.0.0",
  "@angular/upgrade": "^4.0.0",
  "body-parser": "~1.15.2",
  "cookie-parser": "~1.4.3",
  "debug": "~2.2.0",
  "express": "~4.14.0",
  "hbs": "~3.1.0",
  "morgan": "~1.6.1",
  "reflect-metadata": "^0.1.3",
  "core-js": "^2.4.1",
  "rxjs": "^5.2.0",
  "zone.js": "^0.8.5",
  "serve-favicon": "~2.3.0"
},</pre>































































































































































<p>Let's now work on the <code>devDependencies</code>:</p>















































































<p>You may replace the section in the <code>package.json</code> (as we created it in this module)with the following versions:</p>















































































<pre class="prettyprint linenums">"devDependencies": {
  "@ngtools/webpack": "^1.8.0",
  "@types/core-js": "0.9.36",
  "@types/node": "^6.0.45",
  "angular-router-loader": "^0.5.0",
  "angular2-template-loader": "^0.5.0",
  "awesome-typescript-loader": "^3.1.2",
  "del-cli": "^0.2.0",
  "html-loader": "^0.4.4",
  "raw-loader": "^0.5.1",
  "ts-loader": "^2.0.3",
  "typescript": "^2.1.4",
  "webpack": "^2.2.1",
  "webpack-merge": "^4.1.0"
}</pre>































































































































































<p>With that, we should have all the packages and versions we need.</p>









































































<p><strong>2)Time to use these new packages to tweak our webpack configs:</strong></p>









































































<p><strong>In the <code>webpack.common.config.js</code> file</strong>, we'll <strong>remove the <code>.ts</code> loaders</strong> and the <code>ContextReplacementPlugin</code>.</p>



































































<p>Since we use Webpack 2 (final) now, we also should switch to the new <code>module.rules</code> syntax (<a href="https://webpack.js.org/guides/migrating/#module-loaders-is-now-module-rules" rel="nofollow">learn more</a>).</p>



































































<p>Your file should look like this thereafter:</p>









































































<pre class="prettyprint linenums">var webpack = require('webpack');

module.exports = {
    entry: {
        'app': './assets/app/main.ts'
    },

    resolve: {
        extensions: ['.js', '.ts']
    },

    module: {
        rules: [
            {
                test: /\.html$/,
                use: [{ loader: 'html-loader' }]
            },
            {
                test: /\.css$/,
                use: [{ loader: 'raw-loader' }]
            }
        ],
        exprContextCritical: false

    }
};</pre>



















































































































































<p>Since we removed the .ts loaders here, we of course need to add them to the other two files (<code>webpack.config.dev.js</code> and <code>webpack.config.prod.js</code>).</p>



































































<p><strong>Let's do this - starting with <code>webpack.config.dev.js</code>:</strong></p>



































































<pre class="prettyprint linenums">var path = require('path');

var webpackMerge = require('webpack-merge');
var commonConfig = require('./webpack.config.common.js');

module.exports = webpackMerge(commonConfig, {
    devtool: 'cheap-module-eval-source-map',

    output: {
        path: path.resolve(__dirname + '/public/js/app'),
        publicPath: "/js/app/",
        filename: 'bundle.js',
        publicPath: '/js/app/',
        chunkFilename: '[id].chunk.js'
    },
    module: {
        rules: [
            {
                test: /\.ts$/,
                use: [
                    {loader: 'awesome-typescript-loader', options: {
                        transpileOnly: true
                    }},
                    {loader: 'angular2-template-loader'},
                    {loader: 'angular-router-loader'}
                ]
            }
        ]

    }
});</pre>







































































































































<p>What changed?</p>



































































<p>a)The output path got changed to an absolute one, using Node's path helper</p>



































































<p>b)The rules for <code>.ts</code> files were added. Here, we also changed the name of <code>angular2-router-loader</code> to <code>angular-router-loader</code>. That's the current name of this package.</p>



























































<p>Notice the <code>transpileOnly: true</code> option on the <code>awesome-typescript-loader</code>. We need that option, otherwise we'll get an error that it doesn't find the <code>AppModuleNgFactory</code>. This module/ file indeed isn't there but it will be during aot-compilation. So to prevent this error, we tell <code>awesome-typescript-loader</code>, that it shouldn't analyze our whole directory (which it would do by default) but that it should only transpile the given TypeScript code.</p>













































<p><strong>With that, we can move on to the <code>webpack.config.prod.js</code> file.</strong></p>









































<p>We need to adjust the .ts rules there, too (and move to the new webpack syntax of using <code>rules</code> to begin with).</p>









































<p>The file should then look like this:</p>













































<pre class="prettyprint linenums">var path = require('path');

var webpack = require('webpack');
var webpackMerge = require('webpack-merge');
var commonConfig = require('./webpack.config.common.js');
var ngw = require('@ngtools/webpack');

module.exports = webpackMerge.smart(commonConfig, {
    entry: {
        'app': './assets/app/main.aot.ts'
    },

    output: {
        path: path.resolve(__dirname + '/public/js/app'),
        filename: 'bundle.js',
        publicPath: '/js/app/',
        chunkFilename: '[id].[hash].chunk.js'
    },

    module: {
        rules: [
            {
                test: /(?:\.ngfactory\.js|\.ngstyle\.js|\.ts)$/,
                loader: '@ngtools/webpack'
            },
            {
                test: /\.ts$/,
                use: [
                    'awesome-typescript-loader',
                    'angular2-template-loader'
                ]
            }
        ]
    },

    plugins: [
        new ngw.AngularCompilerPlugin({
          tsConfigPath: './tsconfig.aot.json',
          entryModule: './src/app/app.module#AppModule'
        }),
        new webpack.optimize.UglifyJsPlugin({
            sourceMap: false
        })
    ]
});</pre>



























































































<p>What changed?</p>









































<p>a) The <code>output.path</code> was updated (just as it was in the <code>webpack.config.dev.js</code> file).</p>



































<p>b)<code>angular-router-loader</code> was removed, insteadwe use the @ngtools/webpack package (notice the new rule and plugin entry)for lazy loading.</p>









































<p>c)The <code>webpack.NoErrorsPlugin()</code> was removed</p>































<p><strong>3)Adjust the tsconfig files</strong></p>































<p>Almost done!Let's now update the <code>tsconfig.json</code> and the <code>tsconfig.aot.json</code> files!</p>































<p>Since we now use TypeScript 2 in this setup, we can take advantage of some new features.</p>



























<p><strong>The <code>tsconfig.json</code> file should therefore look like this:</strong></p>



























<pre class="prettyprint linenums">{
  "compilerOptions": {
    "moduleResolution": "node",
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "target": "es5",
    "typeRoots": [
      "node_modules/@types"
    ],
    "lib": [
      "es5",
      "dom"
    ]
  }
}
</pre>























































<p>What changed?</p>



























<p>a) <code>typeRoots</code> was added to inform TypeScript about where to find out <code>@types</code> definitions we installed (check package.json)</p>



























<p>b) <code>lib</code> was added to inform TypeScript about some of the features we're about to use. If we omit this, we would get some issues between TS and our <code>@types</code> packages (having duplicate definitions).</p>



















<p><strong>We basically do the same in the <code>tsconfig.aot.json</code> file:</strong></p>



















<pre class="prettyprint linenums">{
  "compilerOptions": {
    "target": "es5",
    "module": "es2015",
    "moduleResolution": "node",
    "sourceMap": false,
    "emitDecoratorMetadata": true,
    "experimentalDecorators": true,
    "removeComments": false,
    "noImplicitAny": false
  },
  "typeRoots": [
    "node_modules/@types"
  ],
  "lib": [
    "es5",
    "dom"
  ],
  "angularCompilerOptions": {
    "skipMetadataEmit": true
  }
}
</pre>







































<p>But here we also may now remove <code>exclude</code>, it shouldn't be required anymore. Also notice that not <code>outDir</code> entry is set.</p>









<p>Finally, adjust your <code>scripts</code> in the <code>package.json</code> file - to be precise, adjust the <code>build:prod</code> script to look like this:</p>









<p><code>"build:prod": "del-cli public/js/app &amp;&amp; ngc -p tsconfig.aot.json &amp;&amp; ngc -p tsconfig.aot.json &amp;&amp; webpack --config webpack.config.prod.js --progress --profile --bail &amp;&amp; del-cli 'assets/app/**/*.js' 'assets/app/**/*.ngsummary.json' 'assets/app/**/*.ngstyle.*'"</code><br></p>

<p>The code to clean up the project changed a bit - with that update, no files should remain after running <code>npm run build:prod</code></p>













<p><strong>And that's it - you can find the updated seed project attached to this lecture!</strong></p>
        </div>
    </div>
</div>
</p>
                        </div>
                        </div>
                        </div>
                        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
                        </body>
                        </html>